class Book < ApplicationRecord
  # ----------------------------------------------------------------
  # Includes & Extensions
  # ----------------------------------------------------------------

  # ----------------------------------------------------------------
  # Constants
  # ----------------------------------------------------------------

  # ----------------------------------------------------------------
  # Attributes
  # ----------------------------------------------------------------

  # ----------------------------------------------------------------
  # Associations
  # ----------------------------------------------------------------
  has_many :books_readers
  has_many :readers, through: :books_readers

  # ----------------------------------------------------------------
  # Validations
  # ----------------------------------------------------------------
  validates(
    :title,
    uniqueness: true
  )

  # ----------------------------------------------------------------
  # Callbacks
  # ----------------------------------------------------------------

  # ----------------------------------------------------------------
  # Nested Attributes
  # ----------------------------------------------------------------

  # ----------------------------------------------------------------
  # Scopes
  # ----------------------------------------------------------------
  scope :unread, -> { joins(:books_readers).where(books_readers: { read: false }) }
  scope :read, -> { joins(:books_readers).where(books_readers: { read: true }) }

  # ----------------------------------------------------------------
  # Other
  # ----------------------------------------------------------------

  # ----------------------------------------------------------------
  # Class Methods
  # ----------------------------------------------------------------

  # ----------------------------------------------------------------
  # Instance Methods
  # ----------------------------------------------------------------
  def on_reading_list?(reader_id)
    books_readers.find_by_reader_id(reader_id).present?
  end

  def been_read?(reader_id)
    return false unless on_reading_list?(reader_id)
    books_readers.find_by_reader_id(reader_id).read
  end

  protected

  private
end
